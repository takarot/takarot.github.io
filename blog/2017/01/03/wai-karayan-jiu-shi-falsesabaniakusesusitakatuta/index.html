
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>外から研究室のサーバにアクセスしたかった - rotta's memorandum</title>
  <meta name="author" content="rotta">

  
  <meta name="description" content="machine learning, programming, etc...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://takarot.github.io/blog/2017/01/03/wai-karayan-jiu-shi-falsesabaniakusesusitakatuta">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/bootstrap/bootstrap.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap/responsive.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/syntax/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <style type="text/css">
    body {
      padding-bottom: 40px;
    }
    h1 {
      margin-bottom: 15px;
    }
    img {
      max-width: 100%;
    }
    .sharing, .meta, .pager {
      margin: 20px 0px 20px 0px;
    }
    .page-footer p {
      text-align: center;
    }
  </style>
  <script src="/javascripts/libs/jquery.js"></script>
  <script src="/javascripts/libs/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/bootstrap.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="rotta's memorandum" type="application/atom+xml">
  
  

</head>

<body   >
  <nav role="navigation"><div class="navbar navbar-inverse">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a class="brand" href="/">rotta's memorandum</a>

      <div class="nav-collapse">
        <ul class="nav">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>


        <ul class="nav pull-right" data-subscription="rss">
          <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
          
        </ul>

        
          <form class="pull-right navbar-search" action="https://www.google.com/search" method="get">
            <fieldset role="search">
              <input type="hidden" name="q" value="site:takarot.github.io" />
              <input class="search-query" type="text" name="q" results="0" placeholder="Search"/>
            </fieldset>
          </form>
        
      </div>
    </div>
  </div>
</div>
</nav>
  <div class="container">
    <div class="row-fluid">
      
<article class="hentry span9" role="article">

  
  <header class="page-header">
    
      <h1 class="entry-title">外から研究室のサーバにアクセスしたかった</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-01-03T09:37:00+09:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2017</span></span> <span class='time'>9:37 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>研究室に設置されてる計算用のサーバ(ubuntu)に外からアクセスして、どこからでも実験してやろうじゃねーか
って思ったのがきっかけです。</p>

<p>ちなみに外部からのアクセス方法を調べる前の僕は、外部からのアクセスはこんな以下のようなイメージでした。
<br></p>

<div style="text-align: center;"> 今使ってるPC -> 研究室サーバ </div>


<p><br>
でも調べ始めたらほとんどのサイトが以下のように説明していました。
<br></p>

<div style="text-align: center;"> 今使ってるPC -> 中継サーバ -> 使いたいサーバ </div>


<p><br>
そういうわけで、中継サーバ(vpn)を挟んで研究室のサーバにアクセスすることにしました。</p>

<h3>準備したもの:</h3>

<p>  vpnサーバ,
  アクセスするサーバ</p>

<h3>やったこと:</h3>

<p>  ssh設定,
  ポートフォワード
  リモートフォワード</p>

<h3>「vpnサーバ」</h3>

<p>   DTIさんのvpnを借りました。他社と比べて安かったからです。
   「技術者なら自分でvpnサーバ作れ」とか言いわれそうですが、時間と手間がかかる上に
  目的を見失ってしまいそうなので今回は自作しません。そのうちしてみたい（するとはｒｙ
   とりあえずレンタルしたらグローバルIPアドレスなどの情報がメールで届くので、
  指定してsshでアクセスできるようになります。</p>

<h3>「アクセスするサーバ」</h3>

<p>  ローカルIPアドレスが固定されていて、sshポートが空いていればとりあえずOK。</p>

<h3>「ssh設定」</h3>

<p>  研究室サーバとvpnサーバに、使っているPCのssh公開鍵を設置する。
  セキュアらしいし、いちいちパスワードを入力しなくてもよくなる。</p>

<h3>「ポートフォワード」</h3>

<p>  中継サーバに「このポートにアクセスがあったら、あのポートに繋いでね」ってことをお願いする。
  <figure class='code'><figcaption><span>port foward command </span></figcaption></p>

<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh -L 12345:グローバルIPアドレス:54321　-p ポート番号 -l ユーザ名</span></code></pre></td></tr></table></div>


<p></figure>
  上のコマンドは「12345番ポートにアクセスがあったら、中継サーバ上で54321番ポートにマッピングして」ってこと。</p>

<h3>「リモートフォワード」</h3>

<p>  上記まででここまで出来てる。
  <div style="text-align: center;"> 今使ってるPC -> 中継サーバ </div></p>

<p>  じゃああとは中継サーバから研究室のサーバにアクセスすりゃいいやん！</p>

<p>  って思うじゃん？
  研究室サーバのIPアドレスってなによ・・・ってなりました。
  どうやら研究室サーバにはグローバルIPが割り振られていない模様。
  さらにローカルIPも固定されていない模様。
  この状態で目的達成できるの？って調べたらできそうな方法がありました。</p>

<p>  固定グローバルIPが割り振られていない、かつ、ローカルIPが固定されているならば、
  リモートフォワードで中継サーバと繋げばいい。
  研究室サーバ上で下のコマンドを実行する。
  僕の場合は研究室のデスクトップPCにteamviewerを入れて、それを使って研究室サーバにアクセスしています。
  <figure class='code'><figcaption><span>remote foward command </span></figcaption></p>

<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh -R 54321:研究室サーバのhostname:22222</span></code></pre></td></tr></table></div>


<p></figure>
  上のコマンドは、「54321番ポートにアクセスがあったら、研究室サーバの22222番ポートにアクセスする」って意味。</p>

<p>  初めの説明では、こんな感じで目的達成しようとしてました。
  今使ってるPC -> 中継サーバ -> 使いたいサーバ</p>

<p>  それが実際にはこんな感じ。
　今使ってるPC -> 中継サーバ &lt;- 使いたいサーバ</p>

<p>ここまで出来たらこいつでトドメ。</p>

<figure class='code'><figcaption><span>remote foward command </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh  研究室サーバのユーザ名@研究室サーバのhostname -p22222</span></code></pre></td></tr></table></div></figure>


<p>これで外からでもアクセスできました。</p>

<h3>「やらかしたこと」</h3>

<p>  タグにopenSUSEってありますよね。これは研究室サーバのOSに使いました。
  あれでも研究室ubuntuだって・・・
  やらかしました。ローカルIPアドレスを固定したつもりで再起動したらIPが割り振られませんでした。
  GUI環境が研究室サーバに入っていれば、モニタを接続して設定し直すこともできたのですが、あいにくCUI環境だった・・・
  それでもモニタ繋いだら映るのかなぁとか今更ながら思ったりする。</p>

<p>  ということで、サーバにOSを入れ直して、１から環境を作ることになりました。
  反省はした。後悔はしてない。</p>

<p>  新しく入れるOSは何がいいだろうって悩みました。
  サーバで用いられるOSは以下のようなものが多いらしい
<br>
    RedHat,CentOS,Debian&hellip;
<br>
  RedHaｔは有償、CentOSは去年の講義の実験で使ったことがある、Debianは聞いたことがある。
<br>
<br>
  でもなんか他の使いたい（天邪鬼）</p>

<p>  ってことでお気に入りのopenSUSEを使いました。バージョンは42.1です。
  openSUSEも多目的なOSのはずなんですが、なかなかopenSUSEでサーバを建てている人を見かけない・・・</p>

<p>  みんなもっとopenSUSE使ってこ、geeko可愛いから。</p>

<p>&mdash;&mdash;&mdash;&mdash;&mdash;-  2016-12-12 追記 &mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<p>先生が使ってる中継サーバを使わせてもらえば2,3回ほどSSHコマンドを叩けば目的の計算機サーバまでたどり着けることがわかりました。</p>

<p>先生の中継サーバはすでに研究室とのIPアドレスのマッピングが済んでいたため、SSHの鍵の設定をするだけで済みました。</p>

<p>モノは相談ですね。</p>

<p>僕が借りたVPNサーバは何か別のことに使うことにします。
とは言ったものの何に使おう・・・</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">rotta</span></span>

      




<time class='entry-date' datetime='2017-01-03T09:37:00+09:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2017</span></span> <span class='time'>9:37 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/opensuse/'>opensuse</a>, <a class='category' href='/blog/categories/ssh/'>ssh</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://takarot.github.io/blog/2017/01/03/wai-karayan-jiu-shi-falsesabaniakusesusitakatuta/" data-via="xenozeno" data-counturl="http://takarot.github.io/blog/2017/01/03/wai-karayan-jiu-shi-falsesabaniakusesusitakatuta/" >Tweet</a>
  
  
  
</div>

    
    
    <ul class="pager">
      
      <li class="previous"><a class="basic-alignment left"
        href="/blog/2016/11/22/scala-test/" title="Previous Post:
        scala-test">&laquo; scala-test</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
    </ul>
  </footer>
</article>

<aside class="sidebar-nav span3">
  
    <section class="well">
  <ul id="recent_posts" class="nav nav-list">
    <li class="nav-header">Recent Posts</li>
    
      <li class="post">
        <a href="/blog/2017/01/03/wai-karayan-jiu-shi-falsesabaniakusesusitakatuta/">外から研究室のサーバにアクセスしたかった</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/22/scala-test/">scala-test</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/21/ruby-test/">ruby-test</a>
      </li>
    
  </ul>
</section>

<section class="well">
  <ul id="gh_repos" class="nav">
    <li class="nav-header">GitHub Repos</li>
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/takarot">@takarot</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        github.showRepos({
            user: 'takarot',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/asides/github.js" type="text/javascript"> </script>
</section>




<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/blog/tags/opensuse' style='font-size: 160.0%'>openSUSE(1)</a> <a href='/blog/tags/ruby' style='font-size: 160.0%'>ruby(1)</a> <a href='/blog/tags/scala' style='font-size: 160.0%'>scala(1)</a> <a href='/blog/tags/ssh' style='font-size: 160.0%'>ssh(1)</a> <a href='/blog/tags/vpn' style='font-size: 160.0%'>vpn(1)</a> </span>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/linux/'>linux (1)</a></li><li><a href='/blog/categories/opensuse/'>opensuse (1)</a></li><li><a href='/blog/categories/programming/'>programming (2)</a></li><li><a href='/blog/categories/ssh/'>ssh (1)</a></li></ul>
</section>
<section>
  <a class="twitter-timeline"  href="https://twitter.com/xenozeno" data-widget-id="252060129644646400">@xenozenoさんのツイート</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>        

  
</aside>


    </div>
  </div>
  <footer role="contentinfo" class="page-footer"><hr>
<p>
  Copyright &copy; 2017 - rotta -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
